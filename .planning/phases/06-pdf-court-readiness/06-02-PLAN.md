---
phase: 06-pdf-court-readiness
plan: 02
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - src/lib/pdf/sections/methodology.tsx
  - src/lib/pdf/sections/index.ts
  - src/lib/pdf/report-template.tsx
autonomous: true

must_haves:
  truths:
    - "PDF output includes a formal Section 3: Methodology page with inspection process description"
    - "PDF output includes equipment list as subsection 3.2 within the Methodology section"
    - "PDF output includes access method as subsection 3.3 within the Methodology section"
    - "PDF output includes a formal Limitations section (1.3) documenting access restrictions and caveats"
    - "PDF compliance assessment section (Section 7) renders E2/B2/COP tables with pass/fail/NA badges"
    - "TOC inline entries match the actual section numbering in the PDF body"
  artifacts:
    - path: "src/lib/pdf/sections/methodology.tsx"
      provides: "MethodologySection PDF component rendering Section 3"
      exports: ["MethodologySection"]
    - path: "src/lib/pdf/sections/index.ts"
      provides: "Barrel export for MethodologySection"
      contains: "MethodologySection"
    - path: "src/lib/pdf/report-template.tsx"
      provides: "Updated template with MethodologySection integrated between Declaration and Property Details pages"
      contains: "MethodologySection"
  key_links:
    - from: "src/lib/pdf/report-template.tsx"
      to: "src/lib/pdf/sections/methodology.tsx"
      via: "import and JSX usage"
      pattern: "MethodologySection"
    - from: "src/lib/pdf/sections/methodology.tsx"
      to: "src/lib/pdf/styles.ts"
      via: "import styles and colors"
      pattern: "import.*styles.*colors.*from"
    - from: "src/lib/pdf/report-template.tsx"
      to: "ReportData.methodology"
      via: "passing report data as props to MethodologySection"
      pattern: "methodology.*equipment.*accessMethod.*limitations"
---

<objective>
Create the formal PDF section components for Methodology, Equipment, Access Method, and Limitations so the generated PDF contains all ISO 17020 required sections. Verify the existing compliance assessment section (Section 7) already satisfies PDF-05.

Purpose: The PDF currently references Section 3 (Methodology) in the TOC but has no corresponding body. Access method and limitations appear as inline data rows, not as formal court-ready sections. This plan creates the missing sections to make PDFs court-admissible.

Output: New MethodologySection component, updated report-template.tsx with all sections wired in, formal limitations rendering in the Introduction section.
</objective>

<execution_context>
@C:\Users\LukeBoustridge\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\LukeBoustridge\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-pdf-court-readiness/06-01-SUMMARY.md

Key files to read before implementing:
@src/lib/pdf/report-template.tsx (2400+ lines - the main assembly)
@src/lib/pdf/sections/declaration.tsx (pattern reference for section component)
@src/lib/pdf/sections/toc.tsx (TOC entries that must match body sections)
@src/lib/pdf/sections/index.ts (barrel exports)
@src/lib/pdf/components.tsx (reusable components: Header, Footer, SectionHeading, etc.)
@src/lib/pdf/styles.ts (shared styles and colors)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create MethodologySection PDF component</name>
  <files>
    src/lib/pdf/sections/methodology.tsx
    src/lib/pdf/sections/index.ts
  </files>
  <action>
**Create `src/lib/pdf/sections/methodology.tsx`**

Follow the exact pattern from `declaration.tsx`: import from `../react-pdf-wrapper`, use `../styles` for colors/styles, use `../components` for Header/Footer.

The component should be a full `<Page>` component (like Declaration and CoverPage) that renders Section 3: Methodology.

**Props interface:**
```typescript
interface MethodologySectionProps {
  reportNumber: string;
  methodology: string | null;
  equipment: string[] | null;
  accessMethod: string | null;
  weatherConditions: string | null;
  inspectionType: string;
  inspectionDate: Date;
  limitations: string | null;
}
```

**Section layout (single page):**

The page should use the same header/footer pattern as Declaration (Header component with reportNumber, Footer component at bottom).

**3. METHODOLOGY** (main heading using SectionHeading or equivalent bold text)

Brief intro paragraph: "This section describes the inspection methodology, equipment used, and access methods employed during this inspection, in accordance with ISO/IEC 17020:2012 requirements."

**3.1 Inspection Process** (subsection)
- Render `methodology` text if present, otherwise render a default: "Visual inspection conducted in accordance with RANZ Roofing Inspection Methodology 2025 and ISO/IEC 17020:2012 conformity assessment requirements."
- Below the methodology text, add an info box showing:
  - Inspection Type: `{inspectionType}` (formatted -- replace underscores with spaces, title case)
  - Date: `{inspectionDate}` (formatted)

**3.2 Equipment Used** (subsection)
- If `equipment` array is not null and has items, render as a numbered list using a table-like layout:
  Each row: bullet/number + equipment name
- If equipment is null/empty, render: "Standard visual inspection equipment. No specialist instruments recorded for this inspection."

**3.3 Access Method** (subsection)
- If `accessMethod` is present, render it as body text.
- If null, render: "Access method not recorded."

**3.4 Weather Conditions** (subsection)
- If `weatherConditions` is present, render it.
- If null, render: "Weather conditions not recorded."

**3.5 Limitations & Restrictions** (subsection)
- This is the FORMAL limitations section required by ISO 17020.
- If `limitations` is present, render with a warning-style box (yellow/amber left border, light background) containing the limitations text.
- Add a standard disclaimer below: "Areas not inspected or assessed should not be assumed to be free of defects. This report is limited to the scope defined herein."
- If limitations is null, render: "No specific limitations were encountered during this inspection. Standard limitations apply as outlined in the scope of works."

**Styling:**
- Use `styles.page` (with paddingTop: 80, paddingBottom: 60 like declaration.tsx) for the Page
- Use `colors.charcoal` for headings
- Use `colors.charcoalLight` for subsection headings
- Section number styling: fontSize 18, fontWeight 700, color charcoal, textTransform uppercase
- Subsection styling: fontSize 12, fontWeight 700, color charcoal, marginTop 15, marginBottom 8
- Body text: fontSize 10, lineHeight 1.6, color gray700
- Equipment list items: fontSize 10, with bullet or number prefix
- Limitations warning box: padding 12, backgroundColor "#fffbeb" (light amber), borderLeftWidth 3, borderLeftColor colors.ranzYellow

Export the component as a named export: `export function MethodologySection(...)`.

**Update `src/lib/pdf/sections/index.ts`**

Add the export:
```typescript
export { MethodologySection } from "./methodology";
```
  </action>
  <verify>
1. Run `npx tsc --noEmit` -- no type errors in the new file
2. Confirm the file exports MethodologySection by checking the barrel export in index.ts
  </verify>
  <done>
- MethodologySection component exists at src/lib/pdf/sections/methodology.tsx
- Component renders Section 3 with subsections 3.1-3.5
- Handles null/missing data gracefully with sensible defaults
- Limitations rendered in a visually distinct warning box
- Exported from sections/index.ts barrel
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire MethodologySection into report-template.tsx and update inline TOC</name>
  <files>
    src/lib/pdf/report-template.tsx
  </files>
  <action>
**Step 1: Import MethodologySection**

At the top of report-template.tsx (around line 13-17 where other sections are imported), add:
```typescript
import { MethodologySection } from "./sections/methodology";
```

Or add it to the existing barrel import if using one:
```typescript
import { CoverPage, TableOfContents, Declaration, EvidenceCertificate, PhotoAppendix, MethodologySection } from "./sections";
```

**Step 2: Insert MethodologySection into the Document**

In the JSX `<Document>` (starting around line 791), the current order is:
1. CoverPage
2. TableOfContents (new-style section component)
3. Declaration
4. Property Details Page (inline)
5. Executive Summary Page (inline)
6. Table of Contents Page (inline, legacy -- this is a SECOND TOC, inline in report-template.tsx around line 1116)
7. Glossary Page
8. Expert Witness Declaration Page (inline, legacy -- around line 1380)
9. Factual Observations (Section 5)
10. Defects Register (Section 6)
11. Compliance Assessment (Section 7)
12. Recommendations Summary (Section 10)
...appendices...

Insert the `<MethodologySection>` component AFTER the inline Table of Contents page (legacy TOC, line ~1237) and BEFORE the Glossary page (line ~1239). This places it as Section 3 in the report body, matching the TOC entry "3. Methodology".

Actually, looking at the document flow more carefully: the intended ISO 17020 structure from the inline TOC is:
- Cover Page & Property Details
- Executive Summary
- Expert Witness Declaration
- Glossary of Terms
- 1. Introduction & Scope
- 2. Inspector Credentials
- 3. Methodology (THIS IS WHAT WE ADD)
- 4. Property Description
- 5. Factual Observations
- 6. Defects Register
- 7. Building Code Compliance Assessment
- 8. Analysis & Discussion
- 9. Opinions & Conclusions
- 10. Recommendations

The Methodology section should go AFTER the Glossary page and the inline Expert Witness Declaration (which is Section 2-like content). The best insertion point is after the inline Expert Witness Declaration page (which ends around line 1583) and BEFORE the Factual Observations section (line 1586).

Insert:
```tsx
{/* Section 3: Methodology (ISO 17020 Required) */}
<MethodologySection
  reportNumber={report.reportNumber}
  methodology={report.methodology}
  equipment={report.equipment}
  accessMethod={report.accessMethod}
  weatherConditions={report.weatherConditions}
  inspectionType={report.inspectionType}
  inspectionDate={new Date(report.inspectionDate)}
  limitations={report.limitations}
/>
```

**Step 3: Remove inline access method and limitations from Property Details page**

Currently, access method appears as an inline row in the "Inspection Details" section (lines ~901-906) and limitations appears as a subsection (lines ~951-957) on the Property Details page. Since these now have their own formal Section 3 rendering:

- KEEP the access method inline row on the Property Details page (it's useful as a quick reference alongside inspection date/type/weather). Do NOT remove it.
- KEEP the limitations inline on the Property Details page too -- it serves as a summary. The formal Section 3.5 provides the detailed treatment.

So: No removals needed. The Property Details page retains its existing data rows. The new Section 3 provides the formal, structured ISO 17020 presentation.

**Step 4: Update the inline TOC to be accurate**

The inline TOC (starting around line 1130) already has "3. Methodology" with subsections 3.1/3.2/3.3. Update the subsection labels to match our actual subsections:

Find the "3. Methodology" TOC entry block (around line 1161-1168). Update its subsections to:
```tsx
<View style={{ marginLeft: 15, marginTop: 3 }}>
  <Text style={{ fontSize: 8, color: colors.mediumGray }}>3.1 Inspection Process</Text>
  <Text style={{ fontSize: 8, color: colors.mediumGray }}>3.2 Equipment Used</Text>
  <Text style={{ fontSize: 8, color: colors.mediumGray }}>3.3 Access Method</Text>
  <Text style={{ fontSize: 8, color: colors.mediumGray }}>3.4 Weather Conditions</Text>
  <Text style={{ fontSize: 8, color: colors.mediumGray }}>3.5 Limitations & Restrictions</Text>
</View>
```

**Step 5: Verify compliance section (Section 7) is working**

This is a verification-only step. Read the compliance assessment page code (around lines 1819-1921) and confirm:
- It renders when `hasComplianceData` is true
- It shows E2/AS1, Metal Roof COP, and B2 Durability tables via ComplianceTableSection
- Each item shows pass/fail/partial/NA status
- Summary statistics are shown
- Non-compliance warning box appears when there are failures

If the compliance section is working as expected (which research confirms it is), no changes needed. Document this verification in the summary.

**Important notes:**
- Do NOT modify the new-style `TableOfContents` section component (`src/lib/pdf/sections/toc.tsx`). That component has its own entry list generation and would need separate updating if its numbering needs to change. The inline TOC in report-template.tsx is the one visible in most PDF outputs.
- Do NOT renumber existing sections. The existing section numbering (5 for Observations, 6 for Defects, 7 for Compliance, 10 for Recommendations) has gaps because not all numbered sections have body content yet. Section 3 (Methodology) fills one of these gaps.
- Use `"server-only"` import at the top of the new file (matching pattern from other section files).
  </action>
  <verify>
1. Run `npx tsc --noEmit` -- no type errors
2. Run `npm run build` -- build succeeds
3. Search the compiled report-template for "MethodologySection" to confirm it's wired in
4. Search for "3.1 Inspection Process" in the inline TOC to confirm subsection labels updated
5. Search for "BUILDING CODE COMPLIANCE ASSESSMENT" to confirm Section 7 still renders (no regression)
  </verify>
  <done>
- MethodologySection renders as a formal page in the PDF between the Declaration section and Factual Observations
- Section 3 includes subsections: 3.1 Inspection Process, 3.2 Equipment Used, 3.3 Access Method, 3.4 Weather Conditions, 3.5 Limitations & Restrictions
- Inline TOC subsection labels match the actual section content
- Compliance Assessment (Section 7) confirmed working with E2/B2/COP tables and pass/fail/NA badges
- All five requirements (PDF-01 through PDF-05) are now satisfied in the PDF output
- Build succeeds with no TypeScript errors
  </done>
</task>

</tasks>

<verification>
1. TypeScript compilation: `npx tsc --noEmit` passes
2. Build: `npm run build` succeeds
3. PDF output structure verification:
   - Section 3 Methodology page exists in the document
   - Section 3.1 shows inspection process / methodology text
   - Section 3.2 lists equipment used
   - Section 3.3 describes access method
   - Section 3.5 renders limitations in a warning box
   - Section 7 renders compliance tables with E2/B2/COP and pass/fail/NA
4. Inline TOC entries match actual section content
5. No regression in existing PDF sections (Property Details, Executive Summary, Defects, etc.)
</verification>

<success_criteria>
PDF-01 SATISFIED: PDF includes methodology section (Section 3.1) describing inspection approach
PDF-02 SATISFIED: PDF includes equipment section (Section 3.2) listing instruments used
PDF-03 SATISFIED: PDF includes limitations section (Section 3.5) documenting access restrictions and caveats
PDF-04 SATISFIED: PDF includes access method section (Section 3.3) describing how the roof was accessed
PDF-05 VERIFIED: PDF includes compliance assessment results (Section 7) showing B2/E2/COP analysis with pass/fail/NA status

All five phase requirements are addressed. The PDF is court-ready per ISO 17020.
</success_criteria>

<output>
After completion, create `.planning/phases/06-pdf-court-readiness/06-02-SUMMARY.md`
</output>
